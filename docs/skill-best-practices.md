# 技能(Skill)开发最佳实践：正反模式指南

## 1. 明确目标定义（Goal Definition）

### ✅ 正确模式
- **单一职责原则**：Skill 专注于解决一类明确问题
    - 示例：`react-component-generator`、`sql-injection-detector`
- **清晰的价值描述**：能够用一句话明确表达其核心价值
- **功能边界明确**：只处理特定领域的问题

### ❌ 错误模式
- **功能泛滥**：包含多个无关功能
    - 示例：`general-coding-helper`（同时做代码生成+邮件发送+日志分析）
- **目标模糊**：无法清晰描述具体解决什么问题
- **大而全的设计**：试图解决所有相关问题

---

## 2. 精准触发条件（Trigger Conditions）

### ✅ 正确模式
- **明确的触发时机**：详细描述何时调用此 Skill
- **包含关键词匹配**：定义用户意图的关键短语
- **上下文特征识别**：说明相关的场景特征

**示例**：
> 当用户要求生成一个使用 Tailwind CSS 的响应式导航栏组件时触发

### ❌ 错误模式
- **触发条件模糊**：缺乏具体的触发时机描述
- **关键词不明确**：没有定义用户意图的识别模式

---

## 3. 标准化输入格式（Input Format）

### ✅ 正确模式
- **结构简单**：使用易于理解的数据格式
- **语义清晰**：数据含义明确
- **推荐格式**：纯文本、JSON、代码块
- **异常处理**：说明输入不完整时的处理策略

**示例**：
```markdown
- 用户提供一段 Python 函数代码（可能不含 import）
- 如缺少上下文，仅基于现有内容分析并标注不确定性
```

### ❌ 错误模式
- **格式复杂**：使用过于复杂的嵌套结构
- **语义模糊**：输入数据含义不清

---

## 4. 结构化输出格式（Output Format）

### ✅ 正确模式
- **机器可读**：便于模型解析或下游工具消费
- **示例完整**：提供包含字段名、类型、样例值的输出示例
- **标准格式**：使用 Markdown 表格、JSON、代码块等

**示例**：
```markdown
### 🚨 Issues Found
| Line | Type      | Description |
|------|-----------|-------------|
| 5    | Security  | Hardcoded API key detected. |

### ✅ Fixed Code
```python
# 修复后的代码
```
```

### ❌ 错误模式
- **非结构化输出**：难以解析的自由格式文本
- **缺少示例**：没有提供输出格式示例

---

## 5. 清晰的工作流程（Workflow Clarity）

### ✅ 正确模式
- **分步执行**：3-5 步的具体执行流程
- **可执行性**：每步操作明确、无歧义
- **逻辑连贯**：步骤之间有清晰的依赖关系

**示例流程**：
1. 解析输入代码
2. 静态扫描安全与风格问题
3. 自我验证是否遗漏关键漏洞
4. 生成结构化报告
5. 输出修复后代码

### ❌ 错误模式
- **模糊处理**：使用"视情况而定"等不确定表述
- **步骤不明**：缺少具体的操作细节

---

## 6. 内置纠错能力（Self-Correction Capability）✅【强制】

### ✅ 正确模式
- **验证机制**：输出前主动检查结果正确性
- **具体策略**：提供明确的验证方法
- **错误修正**：发现问题后自动修正

**常见验证策略**：
- 生成测试用例并"模拟运行"
- 对照设计约束逐项核对
- 二次扫描高风险区域

**示例**：
> 在输出最终代码前，请检查：(1) 所有函数是否有类型提示；(2) 是否存在 f-string 拼接 SQL；(3) 是否硬编码了密钥。任一不满足则修正后再输出。

### ❌ 错误模式
- **缺少验证**：没有自我检查机制
- **假设正确**：直接输出未经验证的结果

---

## 7. 系统约束定义（System Constraints）

### ✅ 正确模式
- **能力边界**：明确支持的语言/框架版本
- **输入限制**：定义最大输入长度
- **场景限制**：说明不支持的使用场景
- **合理预期**：避免过度承诺

**示例**：
- 支持：Python 3.7+，JavaScript ES6+
- 输入限制：最大 5000 行代码
- 不支持：实时数据库连接验证

### ❌ 错误模式
- **边界不清**：没有明确的能力限制
- **过度承诺**：声称支持所有场景

---

## 8. 工具集成规范（MCP Integration）

### ✅ 正确模式
- **数量限制**：最多调用 3 个 MCP 工具
- **输入清晰**：每个工具的输入参数明确
- **输出明确**：返回格式一致且可预测
- **职责单一**：每个工具执行单一功能

**工具调用规范**：
```json
{
  "tool": "git-fetch-file",
  "params": {"repo": "user/app", "file_path": "src/main.py", "ref": "main"}
}
```

**设计理念**：
> 强大 Agent = MCP Tools（能力） + Skill（SOP 流程）

### ❌ 错误模式
- **工具过多**：集成超过 3 个以上工具
- **职责混淆**：单个工具承担多种功能

---

## 完善的正反模式示例

### 目标定义示例

**✅ 正确示例**：
```
Skill 名称：api-security-scanner
目标：检测 REST API 代码中的安全漏洞（如注入攻击、认证绕过、敏感数据泄露）
一句话描述：自动扫描 API 代码并报告潜在的安全风险
```

**❌ 错误示例**：
```
Skill 名称：full-stack-dev-assistant
目标：帮助开发者编写前端、后端、数据库、测试、部署、监控代码
一句话描述：全方位的开发助手（太宽泛，无法聚焦）
```

### 输入格式示例

**✅ 正确示例**：
```markdown
输入格式：
- code: string - 待扫描的源代码片段
- language: string - 编程语言类型（可选，默认为自动检测）
- rules: array - 要检查的安全规则列表（可选）

示例：
{
  "code": "def login(username, password):\n    query = f'SELECT * FROM users WHERE name='{username}' AND pass='{password}''",
  "language": "python",
  "rules": ["sql_injection", "hardcoded_credentials"]
}
```

**❌ 错误示例**：
```markdown
输入格式：用户提供的任意格式代码（格式不明确，无法标准化处理）
```

### 输出格式示例

**✅ 正确示例**：
```json
{
  "issues": [
    {
      "line": 2,
      "type": "security",
      "severity": "high",
      "description": "SQL injection vulnerability detected",
      "suggestion": "Use parameterized queries instead of string concatenation",
      "code_snippet": "query = f'SELECT * FROM users WHERE name='{username}' AND pass='{password}''"
    }
  ],
  "summary": {
    "total_issues": 1,
    "high_severity": 1,
    "medium_severity": 0,
    "low_severity": 0
  }
}
```

**❌ 错误示例**：
```
输出：各种格式的混合（有时是列表，有时是段落，有时是表格）
```

### 工作流程示例

**✅ 正确示例**：
```markdown
1. 解析输入代码并识别编程语言
2. 根据指定规则或默认规则扫描代码
3. 使用模式匹配算法检测潜在漏洞
4. 将检测结果按严重程度排序
5. 生成包含问题描述和修复建议的结构化报告
6. 运行自我验证检查确保报告完整性
```

**❌ 错误示例**：
```markdown
1. 分析代码
2. 查找问题（过程不明确）
3. 生成报告（没有具体步骤）
```

---

## 实践建议和检查清单

### 开发前检查清单

- [ ] 是否明确了 Skill 的单一核心目标？
- [ ] 能否用一句话清晰描述 Skill 的价值？
- [ ] 触发条件是否具体明确？
- [ ] 输入格式是否简洁明了？
- [ ] 输出格式是否结构化、易于消费？
- [ ] 工作流程是否可执行、无歧义？
- [ ] 是否包含自我验证机制？
- [ ] 系统约束是否明确定义？
- [ ] 是否遵守 MCP 工具集成规范？

### 开发中注意事项

1. **保持专注**：避免功能蔓延，坚持单一职责
2. **注重验证**：每个重要步骤后都要加入验证逻辑
3. **考虑边界情况**：输入为空、格式错误、超长等情况的处理
4. **用户友好**：错误信息清晰，提供有用的指导建议

### 质量保证要点

1. **测试驱动**：先写测试案例再开发功能
2. **迭代优化**：从最小可行版本开始，逐步完善
3. **文档同步**：及时更新使用说明和示例
4. **性能考量**：避免不必要的计算开销

### 常见陷阱避免

1. **过度工程化**：不要为了功能而功能，解决实际问题优先
2. **忽视错误处理**：始终考虑异常情况和失败路径
3. **缺乏边界意识**：明确定义能力范围，避免过度承诺
4. **忽略用户体验**：输出格式要便于后续处理和展示

### 发布前验证清单

- [ ] 在典型用例上进行了充分测试
- [ ] 错误处理机制正常工作
- [ ] 输出格式符合预期
- [ ] 文档清晰完整
- [ ] 性能满足要求
- [ ] 没有意外的功能依赖

---

## 总结

遵循这些正反模式和实践建议，可以帮助您创建高质量、可靠且易维护的技能(Skill)。记住，好的 Skill 应该像精密的工具一样，专注于解决特定问题，并在每次使用时都能提供一致、可靠的结果。